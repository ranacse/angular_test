- name: Deploy and Build on EC2 Server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ubuntu
          key: ${{ secrets.EC2_SSH_PRIVATE_KEY }}
          # REMOVE: script_options: "-o StrictHostKeyChecking=no" 
          command_timeout: 20m # Add a longer timeout for the slow build process
          script: |
            echo "--- STARTING BUILD & DEPLOY SCRIPT ON EC2 ---"
            
            cd /var/angular/
            
            # 1. Pull the LATEST SOURCE CODE
            sudo git pull origin main 
            
            # 2. Install dependencies and build the code on the EC2
            sudo npm install 
            sudo npm run build -- --output-path=./dist/app-name --base-href=/

            # 3. Ensure the web server owns the final built files
            sudo chown -R www-data:www-data /var/angular/
            sudo systemctl restart apache2
            
            echo "--- DEPLOYMENT SCRIPT FINISHED ---"
